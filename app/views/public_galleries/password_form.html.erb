<% content_for :title, "#{@gallery.title} - Protected Gallery" %>
<% content_for :description, "Password protected photo gallery by #{@gallery.photographer.name}" %>

<div class="skip-link">
  <a href="#main-content">Skip to main content</a>
</div>

<main id="main-content" class="gallery-password-page">
  <div class="password-protection">
    <div class="password-card" data-controller="enhanced-password-form">
      <!-- Lock Icon with Animation -->
      <div class="lock-icon" aria-hidden="true">
        <svg class="lock-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
          <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
        </svg>
      </div>
      
      <!-- Gallery Information -->
      <header class="password-header">
        <h1 class="password-title">Protected Gallery</h1>
        <div class="gallery-info">
          <p class="gallery-name" aria-label="Gallery title">
            "<%= @gallery.title %>"
          </p>
          <p class="photographer-name">
            by <%= @gallery.photographer.name %>
          </p>
        </div>
        <p class="password-description">
          This gallery is password protected. Please enter the access code to view 
          <span class="photo-count"><%= pluralize(@gallery.images.count, 'photo') %></span>.
        </p>
      </header>
      
      <!-- Password Form -->
      <%= form_with url: authenticate_gallery_path(@gallery.slug), 
                    method: :post, 
                    local: false,
                    data: { 
                      enhanced_password_form_target: "form",
                      action: "submit->enhanced-password-form#handleSubmit"
                    },
                    class: "enhanced-password-form",
                    role: "form",
                    aria: { label: "Gallery password form" } do |f| %>
        
        <!-- Password Field -->
        <div class="password-field-group">
          <%= f.label :password, "Access Code", class: "sr-only" %>
          <%= f.password_field :password, 
                              placeholder: "Enter gallery access code", 
                              class: "password-input",
                              data: { 
                                enhanced_password_form_target: "passwordInput",
                                action: "input->enhanced-password-form#handleInput keydown->enhanced-password-form#handleKeyDown"
                              },
                              required: true,
                              autocomplete: "off",
                              aria: { 
                                label: "Gallery access code",
                                describedby: "password-help"
                              } %>
          
          <!-- Password Strength/Status Indicator -->
          <div class="password-status" 
               data-enhanced-password-form-target="passwordStatus"
               aria-live="polite"
               aria-atomic="true">
          </div>
        </div>

        <!-- Error Display -->
        <div class="password-error-container" 
             data-enhanced-password-form-target="errorContainer"
             role="alert" 
             aria-live="assertive"
             aria-atomic="true">
          <% if @error %>
            <div class="password-error visible">
              <svg class="error-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
                <circle cx="12" cy="12" r="10"/>
                <line x1="15" y1="9" x2="9" y2="15"/>
                <line x1="9" y1="9" x2="15" y2="15"/>
              </svg>
              <span><%= @error %></span>
            </div>
          <% end %>
        </div>

        <!-- Submit Button -->
        <div class="password-actions">
          <%= f.submit "Access Gallery", 
                       class: "password-submit",
                       data: { 
                         enhanced_password_form_target: "submitButton",
                         disable_with: "Checking access..."
                       } %>
        </div>
      <% end %>

      <!-- Help Text -->
      <div class="password-help">
        <p id="password-help" class="help-text">
          <svg class="help-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
            <path d="M9 12l2 2 4-4"/>
          </svg>
          This gallery is protected for privacy and security
        </p>
        
        <!-- Contact Information (if needed) -->
        <details class="help-details">
          <summary class="help-summary">Need help accessing this gallery?</summary>
          <div class="help-content">
            <p>If you don't have the access code, please contact the photographer directly.</p>
            <p class="photographer-contact">
              <strong><%= @gallery.photographer.name %></strong><br>
              Email: <a href="mailto:contact@photographer.com" class="contact-link">Get in touch</a>
            </p>
          </div>
        </details>
      </div>

      <!-- Attempt Counter (Hidden, for accessibility) -->
      <div class="sr-only" 
           data-enhanced-password-form-target="attemptCounter"
           aria-live="polite">
      </div>
    </div>
    
    <!-- Background Decoration -->
    <div class="password-background" aria-hidden="true">
      <div class="background-pattern"></div>
    </div>
  </div>
</main>

<script>
  // Auto-focus password field when page loads
  document.addEventListener('DOMContentLoaded', function() {
    const passwordInput = document.querySelector('[data-password-form-target="input"]');
    if (passwordInput) {
      passwordInput.focus();
    }
  });
</script>